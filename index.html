<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NeuroPeople | People-centred neurodivergent research</title>
  <meta name="description" content="NeuroPeople curates peer-reviewed, people-centred research focused on lived experience, access, equity, and outcomes for autistic, ADHD, AuDHD, and other neurodivergent people." />
  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <a class="skip-link" href="#latest">Skip to latest research</a>

  <header class="shell">
    <div class="hero">
      <div class="hero-top">
        <div class="brand">
          <img
            src="assets/NeuroPeople_Logo.png"
            alt="NeuroPeople logo: a multicoloured infinity symbol formed by interlinked handprints"
            class="logo"
            width="75"
            height="75"
            loading="eager"
            decoding="async"
          />
          <div>
            <h1>NeuroPeople</h1>
            <p class="subtitle">People-centred neurodivergent research</p>
          </div>
        </div>
        <div class="hero-actions">
          <a class="btn btn-secondary" href="#latest">View latest papers</a>
          <a class="btn btn-ghost" href="#about">About this page</a>
        </div>
      </div>

      <div class="hero-card">
        <p class="lead"><strong>This page exists to centre people.</strong></p>
        <p class="muted">
        Autistic, ADHD and AuDHD people are frequently the subject of research, yet much of this work continues to prioritise deficit, pathology, or the pursuit of normalisation or cure. This often overlooks the everyday experiences of neurodivergent people, including living, accessing services, communicating, learning, working, and achieving a meaningful quality of life. <strong>NeuroPeople</strong> curates research that centres lived experience and adopts neurodiversity-informed approaches, prioritising work grounded in real-world needs, access, equity, and improved outcomes.
        </p>
        <p class="lead">
          <strong>This page highlights peer-reviewed research that aims to understand and improve people’s lives.</strong>
        </p>

        <div class="meta-row" id="metaRow" aria-live="polite"></div>
      </div>
    </div>
  </header>

  <main class="shell">
    <section id="latest" class="section">
      <div class="section-head">
        <div>
          <h2>Latest research</h2>
          <p class="muted" id="countLine">Loading papers…</p>
          <p class="muted" id="orderHint">Ordered by publish date (newest first).</p>
        </div>
      </div>

      <div class="controls" role="region" aria-label="Search and filter papers">
        <div class="search-wrap">
          <label class="label" for="search">Search</label>
          <input
            type="text"
            id="search"
            placeholder="Search titles, journals, or authors"
            autocomplete="off"
          />
        </div>

        <div class="select-wrap">
          <label class="label" for="neurotype">Neurotype</label>
          <select id="neurotype">
            <option value="All">All</option>
          </select>
        </div>
        <div class="select-wrap">
          <label class="label" for="framing">
            Language framing
            <button class="info-btn" type="button" aria-label="What do language framing tags mean?" data-modal="framing">i</button>
          </label>
          <select id="framing">
            <option value="All">All</option>
          </select>
        </div>
        <div class="select-wrap">
          <label class="label" for="domain">Domain</label>
          <select id="domain">
            <option value="All">All</option>
          </select>
        </div>

        <!-- NEW: ordering -->
        <div class="select-wrap">
          <label class="label" for="sortOrder">Order by</label>
          <select id="sortOrder">
            <option value="date_desc" selected>Publish date (newest first)</option>
            <option value="date_asc">Publish date (oldest first)</option>
            <option value="title_asc">Title (A to Z)</option>
            <option value="journal_asc">Journal (A to Z)</option>
          </select>
        </div>

        <!-- NEW: page size -->
        <div class="select-wrap">
          <label class="label" for="pageSize">Papers shown</label>
          <select id="pageSize">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>

        <div class="controls-actions">
          <button class="btn btn-secondary" id="resetBtn" type="button">Reset</button>
          <button class="btn btn-ghost" id="toggleAbstracts" type="button">Show abstracts</button>
        </div>
      </div>

      <div id="papers" class="papers" aria-live="polite"></div>

      <!-- NEW: pager -->
      <div class="pager" id="pager" aria-label="Pagination controls" style="display:none;">
        <button class="btn btn-ghost" id="prevPage" type="button">Previous</button>
        <span class="muted" id="pageInfo"></span>
        <button class="btn btn-secondary" id="nextPage" type="button">Next</button>
      </div>
    </section>

    <section id="about" class="section">
      <details class="details" open>
        <summary>
          <span>ABOUT</span>
          <span class="muted">Purpose, ethos, scope, and selection criteria</span>
        </summary>

        <div class="details-body">
          <div class="grid">
            <div class="card">
              <h3>What this page includes</h3>
              <ul>
                <li>Research centred on lived experience, quality of life, wellbeing, participation, and equity</li>
                <li>Access to services and environments, including healthcare, education, employment, housing, and community support</li>
                <li>Communication, sensory experience, and person-centred practice</li>
                <li>Service design, service improvement, and accessible pathways of care</li>
                <li>Supports, adjustments, or interventions with meaningful real-world outcomes</li>
                <li>Participatory, co-produced, and neurodiversity-informed research approaches</li>
              </ul>
            </div>
            <div class="card">
              <h3>What this page does not include</h3>
              <ul>
                <li>Genetic, molecular, or biochemical mechanisms as the primary focus</li>
                <li>Neuroimaging or biomarker discovery as the primary focus</li>
                <li>Animal models or pre-clinical studies</li>
                <li>Work primarily framed around deficit, normalisation, or cure without clear relevance to lived experience, access, or equity</li>
              </ul>
            </div>
            <div class="card wide">
              <h3>How the research is selected</h3>
              <p class="muted">
                This page is updated using an automated process that monitors selected journals and applies transparent inclusion and exclusion criteria to prioritise people-centred, lived-experience research, including work that is relevant to access, equity, and real-world outcomes. The process may miss some relevant work and may include borderline cases.
              </p>
              <p class="muted">
                Articles are not manually checked. Therefore, inclusion does not imply endorsement of methods, conclusions, language, or framing.<br>
                This page also includes <a href="#latest">language framing tags</a>. These indicate the language used in article titles and abstracts (for example, identity-first or person-first language) and are generated automatically. They reflect wording only and do not represent judgements about authors, research quality, or underlying theoretical approaches.
              </p>
            </div>
          </div>

          <div class="back-row">
            <a class="btn btn-ghost" href="#latest">Back to latest papers</a>
          </div>
        </div>
      </details>
    </section>

    <footer class="footer">
      <p class="muted">
        Built as a one-page, self-updating index. Content links out to DOI or publisher pages.<br>
        Vibe coded by <a href="https://ben-potts.co.uk" target="_blank"><strong>Ben Potts</strong></a>.<br>
        <a href="https://github.com/BenPottsRes/PeopleFirstResearch" target="_blank">GitHub Repository</a>
      </p>
    </footer>
  </main>

  <script>
    function normalise(str) {
      return (str || "").toLowerCase().replace(/\\s+/g, " ").trim();
    }

    function uniq(arr) {
      return Array.from(new Set(arr.filter(Boolean)));
    }

    function safeAuthors(authors) {
      if (!Array.isArray(authors) || authors.length === 0) return "";
      if (authors.length <= 4) return authors.join(", ");
      return authors.slice(0, 3).join(", ") + ", et al.";
    }

    function formatDate(p) {
      // Supports either year or published_date (ISO string)
      if (p.published_date) {
        const d = new Date(p.published_date);
        if (!Number.isNaN(d.getTime())) {
          return d.toLocaleDateString("en-GB", { day: "2-digit", month: "short", year: "numeric" });
        }
      }
      return p.year ? String(p.year) : "";
    }

    function hasArray(p, key) {
      return Array.isArray(p[key]) && p[key].length > 0;
    }

    function parseDateForSort(p) {
      if (p.published_date) {
        const t = Date.parse(p.published_date);
        if (!Number.isNaN(t)) return t;
      }
      if (p.year) return Date.parse(`${p.year}-01-01`);
      return 0;
    }

    fetch("papers.json", { cache: "no-store" })
      .then(r => r.json())
      .then(data => {
        const papers = Array.isArray(data.papers) ? data.papers : [];
        const generatedAt = data.generated_at || null;
        const sourceSummary = data.source_summary || null;

        // Elements
        const papersEl = document.getElementById("papers");
        const searchEl = document.getElementById("search");
        const neuroEl = document.getElementById("neurotype");
        const domainEl = document.getElementById("domain");
        const framingEl = document.getElementById("framing");
        const resetBtn = document.getElementById("resetBtn");
        const toggleAbsBtn = document.getElementById("toggleAbstracts");
        const countLine = document.getElementById("countLine");
        const metaRow = document.getElementById("metaRow");

        // NEW elements
        const sortOrderEl = document.getElementById("sortOrder");
        const pageSizeEl = document.getElementById("pageSize");
        const orderHintEl = document.getElementById("orderHint");

        const pagerEl = document.getElementById("pager");
        const prevPageBtn = document.getElementById("prevPage");
        const nextPageBtn = document.getElementById("nextPage");
        const pageInfoEl = document.getElementById("pageInfo");

        let showAbstracts = false;
        let currentPage = 1;

        // Build select options from data if present
        const neurotypes = uniq(papers.flatMap(p => (p.neurotype || [])));
        const domains = uniq(papers.flatMap(p => (p.domains || [])));
        const framings = uniq(papers.map(p => p.framing).filter(Boolean));
        
        // Populate framing select
        framings.sort((a, b) => a.localeCompare(b)).forEach(f => {
          const opt = document.createElement("option");
          opt.value = f;
          opt.textContent = f;
          framingEl.appendChild(opt);
        });


        // Populate selects
        neurotypes.forEach(n => {
          const opt = document.createElement("option");
          opt.value = n;
          opt.textContent = n;
          neuroEl.appendChild(opt);
        });

        domains.sort((a, b) => a.localeCompare(b)).forEach(d => {
          const opt = document.createElement("option");
          opt.value = d;
          opt.textContent = d;
          domainEl.appendChild(opt);
        });

        // Meta line
        const metaParts = [];
        if (generatedAt) {
          const d = new Date(generatedAt);
          if (!Number.isNaN(d.getTime())) {
            metaParts.push("Last updated " + d.toLocaleString("en-GB", {
              day: "2-digit", month: "short", year: "numeric", hour: "2-digit", minute: "2-digit"
            }));
          }
        }
        if (sourceSummary) metaParts.push(sourceSummary);
        if (metaParts.length) {
          metaRow.innerHTML = metaParts.map(t => `<span class="chip chip-muted">${t}</span>`).join("");
        }

        const baseList = [...papers];

        function updateOrderHint() {
          const mode = sortOrderEl.value;
          const map = {
            date_desc: "Ordered by publish date (newest first).",
            date_asc: "Ordered by publish date (oldest first).",
            title_asc: "Ordered by title (A to Z).",
            journal_asc: "Ordered by journal (A to Z)."
          };
          orderHintEl.textContent = map[mode] || "Ordered list.";
        }

        function applySort(list) {
          const mode = sortOrderEl.value;
          const sorted = [...list].sort((a, b) => {
            if (mode === "date_desc") return parseDateForSort(b) - parseDateForSort(a);
            if (mode === "date_asc") return parseDateForSort(a) - parseDateForSort(b);
            if (mode === "title_asc") {
              return (a.title || "").localeCompare((b.title || ""), "en", { sensitivity: "base" });
            }
            if (mode === "journal_asc") {
              return (a.journal || "").localeCompare((b.journal || ""), "en", { sensitivity: "base" });
            }
            return 0;
          });
          return sorted;
        }

        function render(list) {
          papersEl.innerHTML = "";

          if (list.length === 0) {
            papersEl.innerHTML = `<div class="empty card"><p class="muted">No papers match your filters.</p></div>`;
            return;
          }

          list.forEach(p => {
            const title = p.title || "Untitled";
            const url = p.url || (p.doi ? `https://doi.org/${p.doi}` : "#");
            const journal = p.journal || "";
            const dateStr = formatDate(p);

            const card = document.createElement("article");
            card.className = "paper-card";

            const chips = [];

                        // NEW: framing chip (language-based)
            if (p.framing) {
              chips.push(`<span class="chip chip-framing">
                  ${p.framing}
                  <button class="info-btn" type="button" aria-label="What do framing tags mean?" data-modal="framing">i</button>
                </span>
              `);
            }
            if (hasArray(p, "neurotype")) {
              p.neurotype.slice(0, 3).forEach(n => chips.push(`<span class="chip">${n}</span>`));
            }
            if (hasArray(p, "domains")) {
              p.domains.slice(0, 3).forEach(d => chips.push(`<span class="chip chip-outline">${d}</span>`));
            }
            if (hasArray(p, "tags")) {
              p.tags.slice(0, 4).forEach(t => chips.push(`<span class="chip chip-outline">${t}</span>`));
            }

            const abstractHtml = (showAbstracts && p.abstract)
              ? `<div class="abstract"><p>${p.abstract}</p></div>`
              : "";

            card.innerHTML = `
              <div class="paper-main">
                <h3 class="paper-title">
                  <a href="${url}" target="_blank" rel="noopener">${title}</a>
                </h3>
                <p class="paper-meta">
                  ${safeAuthors(p.authors)}
                  ${journal ? ` · ${journal}` : ""}
                  ${dateStr ? ` · ${dateStr}` : ""}
                </p>
                ${chips.length ? `<div class="chips">${chips.join("")}</div>` : ""}
                ${abstractHtml}
              </div>

              <div class="paper-side">
                <a class="btn btn-secondary btn-small" href="${url}" target="_blank" rel="noopener">
                  Open
                </a>
                ${p.doi ? `<p class="doi muted">DOI: ${p.doi}</p>` : ""}
              </div>
            `;

            papersEl.appendChild(card);
          });
        }

        function applyFilters() {
          const q = normalise(searchEl.value);
          const n = neuroEl.value;
          const d = domainEl.value;
          const f = framingEl.value;

          const filtered = baseList.filter(p => {
            const hay = normalise(
              [p.title, p.journal, safeAuthors(p.authors), (p.tags || []).join(" "), (p.domains || []).join(" ")].join(" ")
            );

            const matchQ = !q || hay.includes(q);
            const matchN = (n === "All") || (Array.isArray(p.neurotype) && p.neurotype.includes(n));
            const matchD = (d === "All") || (Array.isArray(p.domains) && p.domains.includes(d));
            const matchF = (f === "All") || (p.framing === f);

            return matchQ && matchN && matchD && matchF;
          });

          const sorted = applySort(filtered);
          updateOrderHint();

          const pageSize = parseInt(pageSizeEl.value, 10) || 20;
          const total = sorted.length;
          const totalPages = Math.max(1, Math.ceil(total / pageSize));

          if (currentPage > totalPages) currentPage = totalPages;
          if (currentPage < 1) currentPage = 1;

          const start = (currentPage - 1) * pageSize;
          const end = start + pageSize;
          const pageItems = sorted.slice(start, end);

          render(pageItems);

          countLine.textContent = `Showing ${pageItems.length} of ${total} papers (page ${currentPage} of ${totalPages})`;

          if (total > pageSize) {
            pagerEl.style.display = "flex";
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            pageInfoEl.textContent = `Page ${currentPage} of ${totalPages}`;
          } else {
            pagerEl.style.display = "none";
            pageInfoEl.textContent = "";
          }
        }

        // Events
        searchEl.addEventListener("input", () => { currentPage = 1; applyFilters(); });
        neuroEl.addEventListener("change", () => { currentPage = 1; applyFilters(); });
        domainEl.addEventListener("change", () => { currentPage = 1; applyFilters(); });
        framingEl.addEventListener("change", () => { currentPage = 1; applyFilters(); });

        sortOrderEl.addEventListener("change", () => { currentPage = 1; applyFilters(); });
        pageSizeEl.addEventListener("change", () => { currentPage = 1; applyFilters(); });

        prevPageBtn.addEventListener("click", () => {
          currentPage = Math.max(1, currentPage - 1);
          applyFilters();
        });

        nextPageBtn.addEventListener("click", () => {
          currentPage = currentPage + 1;
          applyFilters();
        });

        resetBtn.addEventListener("click", () => {
          searchEl.value = "";
          neuroEl.value = "All";
          domainEl.value = "All";
          framingEl.value = "All";
          sortOrderEl.value = "date_desc";
          pageSizeEl.value = "10";
          currentPage = 1;
          applyFilters();
        });

        toggleAbsBtn.addEventListener("click", () => {
          showAbstracts = !showAbstracts;
          toggleAbsBtn.textContent = showAbstracts ? "Hide abstracts" : "Show abstracts";
          applyFilters();
        });

        // Initial render
        applyFilters();
      })
        .catch((err) => {
          console.error("Failed to initialise page:", err);
        document.getElementById("countLine").textContent = "Unable to load papers.";
        document.getElementById("papers").innerHTML =
          "<div class='empty card'><p class='muted'>Unable to load the research list. Please check that papers.json exists and is valid JSON.</p></div>";
      });
          // NEW: framing info modal behaviour (works on dynamically rendered chips)
      document.addEventListener("click", (e) => {
        if (e.target && e.target.matches(".info-btn[data-modal='framing']")) {
          document.getElementById("framingModal").hidden = false;
        }
        if (e.target && (e.target.id === "closeFramingModal" || e.target.id === "framingModal")) {
          document.getElementById("framingModal").hidden = true;
        }
      });
          // Close framing modal when clicking the overlay
      document.addEventListener("click", (e) => {
        if (e.target && e.target.id === "framingModal") {
          document.getElementById("framingModal").hidden = true;
        }
      });


  </script>

        <!-- NEW: framing info modal -->
      <div id="framingModal" class="modal" hidden>
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="framingTitle">
          <h3 id="framingTitle">Framing tags</h3>
          <p class="muted">
            These tags are assigned automatically based on language used in titles and abstracts. They describe wording only. They do not indicate author intent, study quality, or endorsement of any particular model.
          </p>
          <ul class="modal-list">
            <li><strong>Neurodiversity-affirming</strong>: Uses identity-first language such as “autistic people”.</li>
            <li><strong>Person-first language used</strong>: Uses wording such as “people with autism”.</li>
            <li><strong>Medical or diagnostic framing</strong>: Uses terms such as “autism spectrum disorder” or “ASD”.</li>
            <li><strong>Mixed or transitional framing</strong>: Uses a mixture of the above language forms.</li>
          </ul>
          <button class="btn btn-secondary btn-small" id="closeFramingModal" type="button">Close</button>
        </div>
      </div>

</body>
</html>
